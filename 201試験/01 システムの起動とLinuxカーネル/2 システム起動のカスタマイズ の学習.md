### システム起動のカスタマイズ の学習

#### systemd
- カーネルが起動するとディスク内のルートファイルシステムの/sbin/init（つまりsystemd）を実行する。
- systemdはSysV initに代わる仕組み。
- /sbin/systemdは/sbin/initとリンクされた同じプログラムでPIDには1が割り当てられる。
- メンテナンスを行う方法
    - シングルユーザモード(rescure.target)へ移行する。
        - メンテナンスのためのモード。(レスキューモード)
        - systemd-udevなどの基本的なデーモンと限定されたサービスのみが稼働する。
        - ネットワークに接続されない。
        - rootのみがログインできる。
        - rootのパスワード入力が求められる。
        - GRUBメニューで「systemd.unit=rescure.target」を指定する。
        - /etc/fstabを参照してファイルシステムをマウントし、スワップの記述があれば有効化する。
        - ファイルシステムのバックアップに利用可能なモードとなっている。
    - 緊急モード(emergency.target)へ移行する。
        - rootのパスワード入力が求められる。
        - systemd-udevデーモンのみが起動する。
        - サービスは起動しない。
        - /etc/fstabは参照しない。
        - ルートファイルシステム以外はマウントしない。
        - スワップ領域は有効化されない。
    - systemd(/sbin/init)ではなく/bin/bashを起動する。
        - GRUBメニューで「init=/bin/bash」を指定する。
        - systemdは起動しない。
        - rootのパスワードを忘れた場合に利用する。
- ユニット(Unit)
    - システムの起動処理は多数のUnitと呼ばれる処理単位に分かれている。
    - 全部で12種類
    - Unitの主な種類
        - service
        - device
        - mount
        - swap
        - target
            - SysV initのランレベルに相当。
            - システム起動時に default.taget というUnitが処理される。
            - /etc/systemd/system/default.taget はシンボリックリンクになっている。
              ```
              $ ls -l /etc/systemd/system/default.target
              lrwxrwxrwx 1 root root 36  1月 23  2022 /etc/systemd/system/default.target -> /lib/systemd/system/graphical.target
              ```
            - lnコマンドで default.taget へのシンボリックリンクを張り替えるか、 `systemctl set-default graphical.target` で切り替えられる。
            - ランレベル0
                - poweroff.target
            - ランレベル1
                - rescue.target
            - ランレベル2,3,4
                - multi-user.target
            - ランレベル5
                - graphical.target
            - ランレベル6
                - reboot.target
        - socket
        - timer
